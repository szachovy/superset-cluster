---
- name: end-to-end run
  ansible.builtin.shell: |
    set -euxo pipefail
    source {{ role_path }}/files/system.sh \
      {{ node_prefix }} \
      {{ network_interface }}
    initialize_nodes
    restart_nodes
    superset_node_address=$(superset_node_address)
    docker_swarm_token=$(docker_swarm_token "${superset_node_address}")
    clusterize_nodes
    docker system prune -a --volumes --force
    df -h > /tmp/start_superset.log 2>&1
    free -m >> /tmp/start_superset.log 2>&1
    df -h /var/lib/docker >> /tmp/start_superset.log 2>&1
    df -i >> /tmp/start_superset.log 2>&1
    start_superset >> /tmp/start_superset.log 2>&1
    rm -rf /tmp/start_superset.log
  args:
    executable: /bin/bash
