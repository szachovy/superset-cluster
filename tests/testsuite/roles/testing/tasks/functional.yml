---
- name: "copy superset functional tests source to the container"
  community.docker.docker_container_copy_into:
    container: "{{ node-prefix }}-4"
    path: "{{ role_path }}/files/functional-superset.py"
    container_path: "/opt/superset-cluster/src/functional-superset.py"
    timeout: 10

- name: "run superset functional tests"
  community.docker.docker_container_exec:
    container: "{{ node-prefix }}-4"
    command: "python3 functional-superset.py
        --nodes {{ nodes }}
        --node-prefix {{ node-prefix }}
        --mgmt-hostname {{ mgmt-hostname }}
        --mysql-user {{ mysql-user }}
        --mysql-password {{ mysql-password }}
        --redis-hostname {{ redis-hostname }}
        --redis-port {{ redis-port }}
        --celery-sql-lab-task-annotations {{ celery-sql-lab-task-annotations }}
        --celery-broker {{ celery-broker }}
        --superset-hostname {{ superset-hostname }}
        --database-name {{ database-name }}
        --superset-password {{ superset-password }}"
    chdir: "/opt/superset-cluster/src"
    timeout: 300

- name: "copy mgmt functional tests source to the container"
  community.docker.docker_container_copy_into:
    container: "{{ node-prefix }}-0"
    path: "{{ role_path }}/files/functional-mgmt.py"
    container_path: "/opt/superset-cluster/src/functional-mgmt.py"
    timeout: 10

- name: "run mgmt functional tests"
  community.docker.docker_container_exec:
    container: "{{ node-prefix }}-0"
    command: "python3 functional-mgmt.py
        --nodes {{ nodes }}
        --node-prefix {{ node-prefix }}
        --mgmt-hostname {{ mgmt-hostname }}
        --mysql-user {{ mysql-user }}
        --mysql-password {{ mysql-password }}
        --redis-hostname {{ redis-hostname }}
        --redis-port {{ redis-port }}
        --celery-sql-lab-task-annotations {{ celery-sql-lab-task-annotations }}
        --celery-broker {{ celery-broker }}
        --superset-hostname {{ superset-hostname }}
        --database-name {{ database-name }}
        --superset-password {{ superset-password }}"
    chdir: "/opt/superset-cluster/src"
    timeout: 600
