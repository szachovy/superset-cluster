#!/usr/bin/expect

spawn superset shell
expect ">>>"
send "from flask import current_app; config_file = open('superset_config.py', 'a'); previous_secret_key = current_app.config.get('SECRET_KEY'); config_file.write(f'PREVIOUS_SECRET_KEY = \"{previous_secret_key}\"'); config_file.close();\n"
expect ">>>"
send "exit()"

# send "from flask import current_app; print(current_app.config.get('SECRET_KEY'))\n"

+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+----------------------------------------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+
| created_on          | changed_on          | id | database_name | sqlalchemy_uri                                                      | created_by_fk | changed_by_fk | password                                           | cache_timeout | extra                                                                                                                                | select_as_create_table_as | allow_ctas | expose_in_sqllab | force_ctas_schema | allow_run_async | allow_dml | verbose_name | impersonate_user | allow_file_upload | encrypted_extra                  | server_cert              | allow_cvas | uuid                               | configuration_method | is_managed_externally | external_url |
+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+----------------------------------------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+
| 2024-08-01 08:55:18 | 2024-08-01 08:55:18 |  1 | MySQL         | mysql+mysqlconnector://superset:XXXXXXXXXX@172.18.0.8:6446/superset |          NULL |          NULL | 0x6662336B5A524A343435423945674E623577794563413D3D |          NULL | {
    "metadata_params": {},
    "engine_params": {},
    "metadata_cache_timeout": {},
    "schemas_allowed_for_file_upload": []
}
 |                         0 |          0 |                1 | NULL              |               0 |         0 | NULL         |                0 |                 0 | NULL                             | NULL                     |          0 | 0x0710BFC9DAD54A43B93306EAB8307BC1 | sqlalchemy_form      |                     0 | NULL         |
+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+----------------------------------------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+


+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+--------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+
| created_on          | changed_on          | id | database_name | sqlalchemy_uri                                                      | created_by_fk | changed_by_fk | password           | cache_timeout | extra                                                                                                                                | select_as_create_table_as | allow_ctas | expose_in_sqllab | force_ctas_schema | allow_run_async | allow_dml | verbose_name | impersonate_user | allow_file_upload | encrypted_extra                  | server_cert              | allow_cvas | uuid                               | configuration_method | is_managed_externally | external_url |
+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+--------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+
| 2024-08-01 08:55:18 | 2024-08-01 08:55:18 |  1 | MySQL         | mysql+mysqlconnector://superset:XXXXXXXXXX@172.18.0.8:6446/superset |          NULL |          NULL | NULL               |          NULL | {
    "metadata_params": {},
    "engine_params": {},
    "metadata_cache_timeout": {},
    "schemas_allowed_for_file_upload": []
}
 |                         0 |          0 |                1 | NULL              |               0 |         0 | NULL         |                0 |                 0 | NULL                             | NULL                     |          0 | 0x0710BFC9DAD54A43B93306EAB8307BC1 | sqlalchemy_form      |                     0 | NULL         |
+---------------------+---------------------+----+---------------+---------------------------------------------------------------------+---------------+---------------+--------------------+---------------+--------------------------------------------------------------------------------------------------------------------------------------+---------------------------+------------+------------------+-------------------+-----------------+-----------+--------------+------------------+-------------------+----------------------------------+--------------------------+------------+------------------------------------+----------------------+-----------------------+--------------+